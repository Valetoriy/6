4. Методы двустороннего применения политики качества обслуживания в динамически формируемых наложенных виртуальных частных сетях

Abstract
//
Современные виртуальные частные сети (VPN) строятся на базе различных соединений «последней мили».
Физические скорости передачи данных могут не соответствовать скорости, оговоренной клиентом. Это
приводит к падению трафика со стороны поставщика услуг, когда клиент отправляет трафик на линейной
скорости. Служба VPN по таким линиям может испытывать прерывания соединения и потерю пакетов и
никогда не сходиться в худшем случае. Крупные предприятия одновременно используют несколько
VPN-подключений в разных транспортных сетях. Каждая сеть может иметь разные физические свойства и
требует отдельной политики качества обслуживания (QoS). Его необходимо настроить в обоих
направлениях: от клиента к поставщику услуг и от поставщика услуг к клиенту. Используя оверлейную
VPN, клиенты могут настраивать детальные и симметричные политики QoS. Это обеспечивает
планирование мощности и хорошее качество опыта. Для FlexVPN, основанного на технологии
IKEv2 и IPSec, симметричное качество обслуживания легко достижимо и подходит для крупномасштабных
развертываний. Атрибуты могут храниться локально или получаться с внешнего сервера. Для
конфигурации, которую необходимо применить вручную к большому количеству сетевых устройств, можно
использовать платформу сетевой автоматизации, чтобы ускорить развертывание конфигурации и избежать
проблем с неправильной конфигурацией. Nornir — одна из сред автоматизации, которая в настоящее
время широко используется для развертывания конфигурации.

I. Введение
//
Сети передачи данных в настоящее время проектируются с учетом требований быстро развивающегося
бизнеса и должны быть высоконадежными, ориентированными на приложения и сервисы. Существует как
минимум две точки зрения на сеть передачи данных: поставщик услуг Интернета (ISP) и клиент.

//
Интернет-провайдер обеспечивает соединение последней мили в соответствии с параметрами, связанными
с контрактом, такими как пропускная способность, доступность и другие аспекты соглашения об уровне
обслуживания (SLA). Может случиться так, что соединения последней мили, поддерживающие физическую
скорость, не соответствуют контракту; например, клиент приобрел у интернет-провайдера соединение с
полосой пропускания 200 Мбит/с. Если последней милей будет Ethernet, то необходимо использовать
как минимум соединение 1000BASE. Оставленное без присмотра такое соединение открывает
интернет-провайдеру возможность нарушения договора со стороны клиента, поскольку он будет иметь
доступ к полной скорости линии. Чтобы обеспечить соблюдение контрактной скорости,
интернет-провайдер должен настроить базовую политику качества обслуживания (QoS) как для
входящего, так и для исходящего трафика. Эта настроенная политика будет служить функцией
кондиционирования трафика, сокращая избыточную полосу пропускания и может изменять данные кодовых
точек DS для дальнейшей защиты сети поставщика услуг и обеспечения справедливого использования
услуг. С точки зрения интернет-провайдера этого достаточно для обеспечения стабильного
обслуживания в соответствии с соглашением. При подключении последней мили к сотовой сети могут
возникать аналогичные проблемы в зависимости от того, используется ли для подключения внешний
сотовый модем или он встроен в маршрутизатор виртуальной частной сети (VPN). При использовании
внешнего сотового модема несоответствие скорости передачи данных между скоростью передачи данных,
предлагаемой поставщиком услуг мобильной связи, и внутренним Ethernet-соединением может стать
проблемой. В настоящее время соединения по локальной сети (LAN) 1000BASE распространены
повсеместно и могут использоваться для подключения сотового модема к локальной сети. Таким
образом, клиент сможет отправлять исходящий трафик поставщику услуг на линейной скорости и,
возможно, нарушать контрактную скорость передачи данных. Если интернет-провайдер решит отбросить
избыточный трафик или сеть перегружена, это приведет к потере пакетов или задержке.

Клиент, который использует предоставленную услугу без знания основных свойств и функций сети
передачи данных, может столкнуться с перебоями в обслуживании, связанными с чрезмерным падением
трафика или задержками в доставке пакетов. С точки зрения подключенного оборудования доступна и
используется полная скорость линии. Таким образом, несоответствие скорости передачи данных с любой
стороны может привести к сбоям в работе сети. Ответственность клиента заключается в настройке
приемлемой выходной политики QoS на его оборудовании. В этой статье точка разграничения
установлена на интерфейсе локальной сети оборудования абонента (CPE). CPE находится под
управлением интернет-провайдера, что является лучшим сценарием для интернет-провайдера.
Управление политиками QoS входящего и исходящего трафика, правильная маркировка или перемаркировка
входящего трафика, а также организация очереди на выходе могут осуществляться как можно ближе к
локальной сети клиента. Это приводит к выравниванию скорости последней мили для исходящего трафика
клиентов к интернет-провайдеру. Это оставляет открытой проблему с исходящим трафиком
интернет-провайдера в сторону клиента. Давайте рассмотрим центральный офис клиента с
высокоскоростным подключением последней мили к интернет-провайдеру, например 10GBASE. Исходящий
трафик клиентов к интернет-провайдеру может достигать скорости линии 10 Гбит/с и потенциально
выходить за пределы небольших филиалов с соединениями последней мили 1000BASE. Если контрактная
скорость для сайта филиала будет еще ниже, то сбои в обслуживании возникнут еще быстрее.
//^
Заказчиком данного исследования является крупное предприятие с головным офисом и множеством
филиалов. Все сайты подключены к одному и тому же интернет-провайдеру, а MPLS Layer 3 VPN
используется для обеспечения IP-маршрутизации между сайтами клиентов.

//
Чтобы обеспечить безопасную связь между сайтами клиентов, к маршрутизатору головного офиса с
каждого маршрутизатора сайта филиала клиента создается динамическое наложенное VPN-соединение.
Штаб-квартира служит центром VPN, а филиалы — лучами. VPN построен с использованием FlexVPN,
поскольку он предлагает множество преимуществ для динамической настройки атрибутов подключения.
-
Если оставить базовую конфигурацию QoS сети в состоянии, описанном ранее, это приведет к тому,
что каждое направление трафика будет иметь различное распределение полосы пропускания, а
перегрузка сети может привести к нарушению службы наложения VPN.

//?
Привязка клиентского трафика к VPN-соединению обеспечивается за счет применения технологии VRF
(виртуальная маршрутизация и переадресация). Изоляция трафика гарантирована, и как входящий, так и
исходящий трафик должен пересекать VPN-туннель. Это позволяет использовать потуннельное качество
обслуживания со стороны штаб-квартиры, а трафик, отправляемый из штаб-квартиры в филиалы, может
быть ограничен по скорости, чтобы соответствовать контрактной скорости «последней мили» удаленного
сайта, что обеспечивает лучшее качество обслуживания для конечных пользователей. Если каждый
филиал имеет разную скорость последней мили, то для каждого ограничения скорости необходимо
настроить отдельную политику QoS, а затем применить ее к соответствующему VPN-подключению. Каждый
филиал должен иметь уникальный идентификатор, чтобы политика QoS могла быть сопоставлена и
применена к динамически формируемому туннелю.

В ответ на эти проблемы в данной исследовательской работе показано, как можно использовать
внешний сервер RADIUS для автоматизации настройки атрибутов туннеля. Кроме того, автоматизация
сети будет использоваться для внесения изменений в конфигурацию в крупных развертываниях.
Оставшаяся часть теста организована следующим образом. В разделе II показаны строительные блоки
динамической многоточечной VPN FlexVPN. После построения архитектуры в разделе III определяются
динамически настраиваемые атрибуты и показаны методы их настройки. Наконец, в разделе IV
приводятся выводы и будущая работа.

II. Строительные блоки FlexVPN
А. Базовые технологии
FlexVPN основан на Интернет-обмене ключами версии 2 (IKEv2), реализованном в соответствии с
RFC4306. Это протокол управления ключами нового поколения [3]. Это значительно расширяет
возможности управления ключами по протоколу IKEv1. IKEv2 поддерживает взаимную аутентификацию
участвующих сторон и помогает устанавливать и поддерживать ассоциации безопасности (SA).

FlexVPN — это встроенная платформа Cisco для настройки IPSec VPN на основе IKEv2, которая не
поддерживает IKEv1 [4]. IKEv2 имеет преимущество в плане безопасности перед IKEv1, поскольку
поддерживает криптографические алгоритмы уровня Suite B. Он имеет встроенную поддержку обнаружения
мертвых узлов (DPD) для поддержания соединения. Кроме того, поддерживается обход NAT, позволяющий
устанавливать безопасное соединение через общедоступную инфраструктуру, где обычно используется
NAT (например, бесплатный Wi-Fi). Методы одноранговой аутентификации расширены по сравнению с
IKEv1 и содержат не только PSK, но и аутентификацию на основе сертификатов, а также EAP. Для
аутентификации удаленного доступа IKEv2 вместо XAUTH используется EAP. Поддерживаемые методы
аутентификации включают туннелирование EAP (EAP-TLS, EAP-PSK, EAP-PEAP) и нетуннелирование EAP
(EAP Anyconnect, EAP-MD5, EAP-GTC и EAP-MSCHAPv2).

Он обеспечивает унифицированную парадигму и интерфейс командной строки, который охватывает
топологии типа «сеть-сайт», «звездообразный» и «концентратор», удаленный доступ и частичную сетку
(динамические межсетевые туннели). Он основан на принципах туннельного интерфейса, обеспечивая
совместимость с устаревшими решениями VPN, использующими криптографические карты.

Он поддерживает многопротокольную коммутацию меток (MPLS), хорошо зарекомендовавшую себя
технологию, которая обеспечивает возможность назначать метки для каждого VRF или более подробную
информацию для каждого префикса. Метки используются для определения того, какой VRF является целью
маршрутизации данных, которые необходимо маршрутизировать. Простая реализация этой
функциональности осуществляется с использованием всего одного туннельного интерфейса с поддержкой
MPLS. В этом туннеле включено шифрование IPsec для защиты трафика данных, и между концентратором и
периферийными устройствами необходим только один туннель IPsec. Это устраняет необходимость
реализации отдельных туннелей для каждого трафика данных, которые должны быть разделены на уровне
3 (с использованием VRF), упрощает настройку и упрощает внедрение и вывод из эксплуатации новых
услуг.

Транспортировка MPLS через FlexVPN обеспечивает простое и легко масштабируемое решение, когда
требуется связь между перекрывающимися адресами или приложениями в одних и тех же сетях клиентов.
Это дополнительно расширяется за счет требования динамического обнаружения новых сетей удаленных
клиентов с использованием протокола разрешения следующих переходов (NHRP). Безопасность связи
обеспечивается за счет использования шифрования IPsec между конечными точками туннеля.

Это решение позволяет быстро расширить существующую сеть MPLS и интегрировать пользователей
удаленного доступа с основной сетью. Это позволяет быстро развертывать новые ветки и снижает
затраты на настройку. Также отпадает необходимость в выделенной линии, и соединение с центральным
VPN-концентратором штаб-квартиры может быть безопасно обеспечено через общедоступный Интернет.
Если клиент обновляет соединение до выделенной линии, меняется только точка входа в
VPN-концентратор, а шаблон конфигурации можно использовать повторно без дополнительных
модификаций.

IPSec защищает трафик данных между лучом и концентратором. Он также защищает трафик между лучами
после завершения динамического обнаружения удаленных лучей. IKEv2 автоматически добавляет
статические маршруты через адрес наложения однорангового туннеля и устанавливает их в таблицу
маршрутизации при установлении удаленного соединения. Этот статический маршрут вызывает неявную
установку нулевой метки в базу информации о метках (LIB), указывающую на адрес наложения
однорангового туннеля.

В этом процессе участвуют два типа сетей и адресов. Во-первых, существует транспортная сеть,
которую можно назвать подземной. Мы предполагаем, что ранее не было известно о фактических
адресах, используемых лучевым устройством для связи с остальной частью сети. Затем существует
оверлейная сеть, построенная поверх базовой транспортной сети. Он имеет отдельную схему адресации,
которая не отображается напрямую в транспортной сети. Для создания сопоставления подложки и
наложения используется протокол NHRP. Во-первых, он создается, когда луч инициирует связь с
концентратором, а затем может быть удален, когда луч отключается. Это позволяет создать защищенный
канал связи. Могут быть случаи, когда для настройки туннеля используется интерфейс универсальной
инкапсуляции маршрутизации (GRE). Затем протокол NHRP будет использоваться для создания и
поддержки базы данных сопоставлений между адресами оверлея и NBMA, тем самым скрывая реальную
транспортную сеть от пользователей сети и обеспечивая безопасную связь между оверлейными
IP-адресами для пользователей сети. MPLS используется для переключения меток при пересылке
фактического трафика данных. Протокол распределения меток (LDP) по умолчанию отключен между
лучами, поскольку его включение приведет к тому, что туннель между лучами будет постоянно работать
только с функцией поддержки обмена информацией LDP, и это нежелательное поведение, когда
фактический трафик пользовательских данных отсутствующий. Чтобы преодолеть это ограничение,
используется многопротокольный BGP (MP-BGP) для распределения префиксов оверлейной сети, которые
могут находиться в разных экземплярах VRF, и назначенных меток для каждой сети.

Он очень гибок в отделении транспортной сети от трафика пользовательских данных. Для каждой
доступной транспортной сети можно использовать отдельный VRF, а каждую пользовательскую службу
или сеть можно изолировать в своем собственном экземпляре VRF. Таким образом достигается
безопасность, удаляя из топологии один вектор атаки. Даже если подсети перекрываются, это
устраняется разделением VRF. Каждая транспортная сеть может иметь свой собственный шлюз по
умолчанию, а также могут существовать перекрывающиеся пользовательские сети, каждая в своем
собственном VRF. Это имитирует способ, которым интернет-провайдеры (ISP) обеспечивают
мультиплексирование через MPLS L3 VPN (VRF) для своих клиентов через общую магистраль. В рамках
FlexVPN транспортная сеть или подложка называется передним VRF (fVRF), а внутренняя сеть передачи
данных пользователя — внутренним VRF (iVRF). Внутренний VRF используется только для пересылки
расшифрованного пользовательского трафика и не имеет информации о транспортной сети. Это
обеспечивает гибкую мультитенантную магистраль, а один общий сервер может обеспечить разделение
нескольких служб передачи данных с изоляцией уровня 3.

Б. Общие блоки конфигурации
Для FlexVPN необходимы следующие компоненты конфигурации IKEv2 и IPSec. Обязательное предложение
IKEv2, определяющее алгоритм шифрования, целостности и группу DH, используемые для защиты при
согласовании IKEv2 SA. Унифицированный CLI позволяет указать несколько записей для каждого
параметра. Метод аутентификации не включен в предложение. Обязательная политика IKEv2, которая
идентифицирует и правильно сопоставляет удаленные узлы и связывается с предложением IKEv2 путем
привязки ранее созданного предложения IKEv2 к одноранговому сеансу, поэтому оно выбирается для
согласования с определенным узлом VPN. Если используется аутентификация PSK, то связка ключей
IKEv2 является обязательной и используется для определения предварительно общих ключей. Отличие от
IKEv1 заключается в том, что это может быть асимметричная конфигурация, в которой один ключ
определен для локального маршрутизатора, а другой — для удаленного маршрутизатора. Профиль IKEv2
является обязательным и определяет локальные/удаленные идентификаторы IKEv2 (адрес/идентификатор).
Он также устанавливает локальный и удаленный тип аутентификации, который также может быть
асимметричным. Здесь устанавливается ссылка на связку ключей IKEv2, если используется PSK, или на
точку доверия PKI, если используется проверка подлинности сертификата. Набор преобразований IPSec
определяет приемлемые протоколы безопасности и алгоритмы для согласования IPSec SA. Профиль IPSec
ссылается на набор преобразований IPSec и профиль IKEv2. Если они не определены, для набора
преобразований IPSec и профиля IKEv2 используются интеллектуальные значения по умолчанию. К
туннельному интерфейсу прикреплен профиль IPSec. Конфигурацию FlexVPN можно свести к минимуму,
используя интеллектуальные настройки по умолчанию IKEv2. Они определяют значения по умолчанию для
всех компонентов, кроме профиля IKEv2 и брелока (если используется PSK). Они могут быть изменены и
по умолчанию скрыты из конфигурации. Их можно отключить, чтобы обеспечить использование только
разрешенных методов для одноранговой аутентификации и согласования IPSec SA.

C. Конфигурация маршрутизатора-концентратора
В дополнение к стандартным компонентам конфигурации конфигурация маршрутизатора-концентратора
расширена за счет нового интерфейса динамического виртуального туннеля (DVTI), который можно
настроить отдельно для каждой транспортной сети. Динамический подразумевает отсутствие
фиксированной конфигурации для возможных одноранговых узлов и статическое сопоставление с
IP-узлами. Фактический интерфейс VTI на концентраторе создается путем применения предварительно
настроенного шаблона виртуального туннеля (виртуального шаблона) и используется только тогда,
когда фактический удаленный лучевой маршрутизатор или одноранговый узел инициирует соединение с
концентратором. Для каждого нового входящего сеанса выполняется аутентификация IKEv2, и в случае
успеха согласовывается IPSec SA. Если и аутентификация, и согласование пройдены успешно,
динамический туннель создает новый виртуальный интерфейс для каждого лучевого туннеля, наследуя
конфигурацию из общего шаблона. Шаблоны могут быть назначены лучевым соединениям на основе
аутентификации и могут быть адаптированы к конкретным требованиям безопасности и конфигурации
соединения. Виртуальный интерфейс обратной связи используется для источника туннеля и
настраивается в виртуальном шаблоне. Каждый виртуальный шаблон содержит конфигурацию для выбора
того, какая транспортная сеть используется для настройки виртуального интерфейса, и может
указывать отдельный fVRF, если он используется. Наконец, к виртуальному шаблону прикрепляется
профиль IPSec.

D. Конфигурация лучевого маршрутизатора
Звездчатый маршрутизатор имеет ту же стандартную конфигурацию, что и маршрутизатор-концентратор,
но вместо него настроен статический виртуальный туннельный интерфейс (SVTI). Он может иметь
несколько SVTI одновременно в случае, если используется топология с двумя концентраторами или
необходимо поддерживать различные туннели к разным сайтам. IP-адрес туннеля можно установить
вручную или согласовать с Hub.

E. Топологии
Простейшая возможная топология — SVTI «точка-точка» между двумя маршрутизаторами с симметричной
статической конфигурацией с обеих сторон. Также можно настроить поддержку удаленного доступа и
подключиться к VPN-маршрутизатору из VPN-клиента, настроенного на ПК, MAC или устройстве Linux.
Более распространенной является конфигурация Hub и Spoke. Для Spokes необходим как минимум один
концентратор, чтобы обеспечить связь между ними. Топология Dual Hub обеспечивает резервирование.
Топология Hub и Spoke может обеспечить прохождение всего межлучевого трафика через Hub или
позволить лучам динамически формировать туннели Spoke to Spoke. Они инициируются с помощью
перенаправления NHRP и настраиваются только тогда, когда маршрутизатор-концентратор обнаруживает
фактический межлучевой трафик. Чаще всего это связано с коммутацией ярлыков и подводит нас к
последней топологии — гибридной.

F. Конфигурация QoS
Конфигурация QoS для маршрутизатора Hub и Spoke аналогична. Взвешенная справедливая организация
очередей на основе классов (CBWFQ) разделяет трафик на классы трафика и обеспечивает
соответствующие характеристики, такие как полоса пропускания, вес и максимальный лимит пакетов. В
настоящее время это называется модульным качеством обслуживания. Он поддерживает несколько классов
трафика, которые могут быть вложенными, обеспечивая детальный контроль над очередями трафика и
настраиваются как один класс. Он также поддерживает иерархическое качество обслуживания (H-QoS),
которое позволяет определять поведение QoS на каждом из нескольких уровней политики. Это еще
больше расширяет конфигурацию и обеспечивает высокий уровень детализации управления трафиком. Это
широко используется для соединений последней мили, где приобретенная пропускная способность ниже,
чем изначально поддерживает физический интерфейс. Внешняя политика формирует исходящий трафик в
соответствии с купленной полосой пропускания, а внутренняя политика работает в пределах этого
ограничения, обеспечивая поддержку классов внутреннего трафика, таким образом служа двум целям с
одной конфигурацией, применяемой на уровне интерфейса.

Политика QoS маршрутизатора-концентратора прикрепляется к интерфейсу виртуального шаблона и
копируется в интерфейс виртуального доступа во время его создания. Эта конфигурация может быть
общей для всех интерфейсов виртуального доступа, созданных на основе одного и того же виртуального
шаблона или отдельного устройства, на основе идентификации удаленного узла.

На лучевом маршрутизаторе политика QoS привязана к физическому интерфейсу, который является
источником интерфейса VPN-туннеля. Отдельную политику QoS можно настроить на другом интерфейсе
последней мили, если резервный туннель использует другую технологию доступа.

III. Методы конфигурации динамических атрибутов
А. Что можно установить динамически
Ниже приведены несколько важных атрибутов, которые могут быть получены от внешнего RADIUS-сервера
[5]. Атрибут IETF Framed-Pool указывает на имя пула адресов IPv4, используемого сервером FlexVPN
для выделения адресов IPv4 для назначения их клиенту. Выделенный адрес настраивается на стороне
клиента с помощью стандартного атрибута конфигурации IKEv2 INTERNAL_IP4_ADDRESS. Пара Cisco AV
ipsec:ipv6-addr-pool указывает на имя пула адресов IPv6, который используется сервером FlexVPN для
выделения адресов IPv6 для назначения их клиенту. Выделенный адрес настраивается на стороне
клиента с использованием стандартного атрибута конфигурации IKEv2 INTERNAL_IP6_ADDRESS. Cisco AV
Pair ipsec:route-set=prefix настраивает подсеть, которая будет защищена концентратором FlexVPN.
Это настраивается на стороне клиента с помощью IKEv2 с использованием стандартного атрибута
конфигурации INTERNAL_IP4_SUBNET. Более часто используемая пара Cisco AV —
ipsec:route-set=interface. Это создает локальный маршрут и позволяет отправлять настроенный
IP-адрес VPN-интерфейса клиенту или концентратору с использованием стандартного атрибута
конфигурации IKEv2 INTERNAL_IP4_SUBNET. Это необходимо для создания пиринга динамической
маршрутизации через VPN-соединение, например, BGP. Важнейшей AV-парой Cisco является
ip:interface-config. Он используется локально и имеет решающее значение при настройке динамически
создаваемого интерфейса с использованием командных строк режима конфигурации и имитации
фактической конфигурации, выполненной администратором вручную, и применяется только для текущего
соединения. Если настроено исключительно локально, политика авторизации IKEv2 указывает на список
атрибутов AAA, содержащий все необходимые атрибуты конфигурации интерфейса. Этот последний
показанный атрибут позволяет задать несколько команд конфигурации для динамически создаваемого
интерфейса виртуального доступа.

Б. Как это делается
Аутентификация, авторизация и учет (AAA) используются для настройки этих атрибутов. Вначале
определяется список атрибутов AAA. Затем список атрибутов AAA назначается политике авторизации. И,
наконец, на это есть ссылка в политике авторизации IKEv2.

C. Как можно повысить эффективность
//?
Атрибуты каждого луча могут храниться на удаленном сервере RADIUS и запрашиваться по требованию
при подключении лучевого сервера. Это позволяет легко определить конфигурацию QoS для каждого узла
и сократить ручную работу, которая необходима, если локально необходимо использовать разные списки
атрибутов. Параметры конфигурации можно применять для подключений к концентратору для каждого
узла, идентифицированного и выбранного IKEv2. Один профиль IKEv2 может обслуживать множество
разных клиентов или типов лучей. Атрибуты, специфичные для клиента или периферийных устройств,
динамически загружаются с сервера RADIUS. Это устраняет необходимость динамической настройки QoS
для поддержания симметричных политик QoS. Это лучшее решение для крупных развертываний,
позволяющее сэкономить время и уменьшить количество случаев неправильной настройки.

D. Дальнейшая оптимизация
//?
Решения для автоматизации сети можно использовать, если необходимо обновить конфигурацию в крупных
топологиях, где используются сотни устройств и конфигурация не сохраняется на сервере RADIUS.
Одним из решений удаленной настройки является Nornir [6]. Nornir — это платформа автоматизации,
написанная на Python. В настоящее время существует несколько фреймворков автоматизации, таких как
Ansible, Paramiko, Netmiko и Napalm. Они позволяют проводить инвентаризацию сети и применять
настройки, одновременно выполняя задачи на многих устройствах. Это значительно ускоряет настройку
на лучах, когда необходимы изменения конфигурации. Nornir был протестирован в топологии со 130
маршрутизаторами, одновременное изменение конфигурации на всех маршрутизаторах было выполнено
менее чем за 20 секунд. Это значительно сократило время обновления конфигурации. Таким образом,
определенные политики QoS могут быть предварительно определены или позже добавлены на
Spoke-маршрутизаторах, которые будут выбраны для использования со стороны RADIUS.

Nornir был выбран для распространения изменений конфигурации из-за его способности
распараллеливать выполнение задач. Последовательное выполнение задач привело к длительному времени
ожидания, а внесение более 100 изменений конфигурации маршрутизатора вручную занимает много
времени, и конфигурация становится склонной к ошибкам. Автоматическое изменение конфигурации
позволяет ускорить развертывание и при необходимости очень оперативный откат к предыдущему
состоянию сети.

IV. Заключение
Динамический VPN широко используется в современных решениях безопасности. FlexVPN широко
используется как надежная основа для сетей самого разного уровня сложности: от базовых
подключений до многоконцентраторных резервированных топологий.

Политику QoS можно установить одинаково для всех соединений или выбрать для каждого узла на основе
предопределенных атрибутов. Это позволяет детально создавать и применять политику QoS. Общая
контрольная точка помогает поддерживать единую и симметричную конфигурацию QoS.

У симметричного QoS есть недостаток, если он настроен для каждого туннеля на стороне
концентратора. Чтобы это работало правильно, динамические туннели между сайтами должны быть
запрещены. В противном случае резервирование полосы пропускания не может быть обеспечено с
уверенностью. Трафик между лучами может легко переполнить интерфейс, если на одном луче построено
несколько туннелей между лучами. Необходимы дальнейшие исследования для внедрения контроля допуска
вызовов QoS (CAC) на основе протокола резервирования ресурсов (RSVP) или аналогичного метода.
Этого можно достичь с помощью протокола маршрутизации псевдосостояния канала, который сохраняет
информацию обо всех активных туннельных сеансах и соответствующим образом распределяет полосу
пропускания.

Для автоматизации конфигурации сети Nornir использовался для развертывания изменений конфигурации
лучевого маршрутизатора и оказался надежным решением для распространения изменений.
