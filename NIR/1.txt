1. Проектирование двухканального общего GRE через IPSec VPN в сетях P2MP
Abstract
Связь между головным офисом предприятия и несколькими филиалами обычно осуществляется через
общедоступные сети или открытые и небезопасные среды связи, такие как спутниковые каналы,
которые могут полагаться на IPSec VPN для обеспечения безопасной связи и составляют сеть
IPSec P2MP. Большую часть времени, чтобы повысить надежность связи, головной офис связывается
с каждым филиалом по двойным каналам связи. В этой статье мы предлагаем инновационный дизайн
двухканального общего GRE через IPSec VPN в сети P2MP, чтобы обеспечить безопасный канал для
одноадресной и многоадресной передачи данных как для двусторонней, так и для односторонней
связи между головным офисом и филиалами.

I. Введение
Для предотвращения прослушивания или взлома связи между головным офисом и филиалами
используются выделенные линии, обеспечивающие безопасность содержания связи. Однако
использование выделенных линий является дорогостоящим и недоступным для большого числа
компаний, а если связь осуществляется через Интернет, который представляет собой прозрачную и
открытую среду, могут возникнуть риски для безопасности связи. Кроме того, связь посредством
беспроводных каналов, например, между кораблями или между сушей и кораблями, также находится в
открытом и трудноконтролируемом состоянии. Технология IPSec (IP Security) VPN может решить
текущую дилемму, независимо от того, передается ли она через Интернет или по беспроводным
каналам. IPSec предоставляет услуги безопасности данных на уровне IP, предотвращая подделку и
перехват IP-пакетов с помощью алгоритмов аутентификации и шифрования. Однако у IPSec есть и
некоторые недостатки. Например, большое количество операций потребляют сетевые ресурсы,
увеличивают задержку передачи данных, что не способствует передаче услуг с жесткими
требованиями реального времени. Кроме того, IPsec предоставляет только услуги безопасности
«точка-точка» и не поддерживает многоадресную рассылку и т. д.[1].

GRE (General Routing Encapsulation) — это общий протокол инкапсуляции, обеспечивающий
прозрачный канал для передачи данных. Хотя GRE не поддерживает шифрование данных, он
поддерживает многоадресную рассылку. Объединив лучшее из GRE и IPSec, GRE over IPSec можно
использовать для шифрования одноадресных и многоадресных пакетов между головным офисом и
филиалами.

На самом деле существует более одного филиала, а головной офис и несколько филиалов образуют
сеть P2MP (точка-множество точек). Однако GRE и IPSec являются технологиями туннелирования
«точка-точка». Целью данного документа является обеспечение безопасного канала передачи
одноадресных и многоадресных данных в сети P2MP с использованием технологии GRE поверх IPSec.
Кроме того, в среде беспроводной связи также рассматривается создание безопасного канала,
когда обе стороны могут общаться только в одном направлении в крайне плохих ситуациях.

II. Технология IPsec
A. Краткое описание IPSec
IPSec предоставляет услуги безопасности связи, используя следующие два протокола безопасности[1]:
    AH (заголовок аутентификации): AH обеспечивает защиту целостности и аутентификацию источника
        данных, но не поддерживает шифрование.
    ESP (инкапсулирующая полезная нагрузка безопасности). Он включает в себя все функции AH, а
        также поддерживает шифрование.
IPSec может работать в двух режимах[2]:
    Транспортный режим: AH или ESP вставляются между исходным IP-заголовком сообщения и
        заголовком транспортного уровня, защищая только протоколы выше транспортного уровня, в
        ситуациях, когда необходимо обеспечить только сквозную безопасность.
    Туннельный режим: AH или ESP защищает весь исходный пакет и генерирует новый заголовок IP,
        который является общедоступным IP-адресом перед защищенным исходным пакетом.
IPSec получает ключи двумя способами[1]:
    Вручную: администратор заранее вручную настраивает ключи для сторон связи, что является
        низким уровнем безопасности и неудобно для обслуживания. Однако этот способ применим к
        общению в одном направлении между сторонами связи.
    Согласование IKE: стороны связи динамически согласовывают ключи через протокол IKE, который
        прост в настройке и имеет более высокий уровень безопасности, но неприменим к случаю
        связи в одном направлении.

Б. GRE через IPSec
Механизм протокола IPSec определяет, что поддерживать многоадресную рассылку сложно. Пакеты
многоадресной рассылки могут быть сначала инкапсулированы в одноадресные пакеты через GRE,
затем через IPSec и затем переданы в общедоступную сеть. Вот пример процесса инкапсуляции GRE
через IPSec. Как показано на рис. 1, между частными сетями A и B устанавливается соединение GRE
over IPSec VPN. Когда применяются ESP и туннельный режим, сначала к исходному IP-пакету из
частной сети A добавляется заголовок GRE-IP. Затем GRE- IP-пакет шифруется в зашифрованный
текст. Заголовок ESP-IP добавляется к зашифрованному тексту для формирования пакета GRE over
IPSec, который в конечном итоге передается в частную сеть B в общедоступной сети.

[[PIC1, GRE через инкапсуляцию IPSec]]

III. Разработка программы
Предположим, что судоходная компания представляет собой сеть P2MP, в которой наземный штаб
должен поддерживать связь с каждым из двух грузовых судов. Как показано на рис. 2, между
штаб-квартирой и каждым судном существует два канала связи, один из которых спутниковая связь
во время плавания судна, еще один — доступ в Интернет по оптоволоконному кабелю, когда судно
находится в порту. Оба канала открыты и небезопасны, поэтому между штаб-квартирой и каждым
судном необходимо установить соединение GRE over IPSec VPN, чтобы обеспечить безопасность
одноадресной и многоадресной связи.

[[PIC2, Проектирование двухканального общего GRE через IPSec VPN в сети P2MP]]

Между штабом-CR и каждым кораблем-ER есть два выхода. Если для каждого канала необходимо
развернуть соответствующий туннель GRE over IPSec, это не только утомительно в настройке, но
и является пустой тратой ресурсов устройства. В этом документе используется режим совместного
использования нескольких ссылок. Интерфейс Loopback используется для установления IPSec VPN с
узлами ike. Два узла согласовывают только одну ассоциацию безопасности, поэтому даже если
соединение прерывается, связь между штаб-квартирой и кораблем не затрагивается.

Процесс настройки состоит из четырех этапов в порядке планирования адресов, планирования
маршрутов, развертывания GRE и развертывания IPSec. Следует отметить несколько моментов.
    (a) Адрес интерфейса Loopback используется в качестве адреса инкапсуляции туннеля GRE.
    (b) Интерфейс Loopback используется для установления туннеля IPSec. IP-адрес интерфейса
        Loopback передается в общедоступной сети в виде обычного текста и должен быть
        установлен как общедоступный IP-адрес.
    (c) В штаб-квартире развернута группа по политике IPSec. Группа политик ipsec содержит
        политики безопасности для каждого корабля.
    (d) Политика безопасности штаб-квартиры и корабля установлена на общую политику безопасности.
    (e) Когда штаб связывается с кораблем в одном направлении, ключ должен быть создан с
        использованием ручной настройки.

IV. Экспериментальное моделирование
Согласно указанной выше схеме для экспериментальной проверки используется платформа
моделирования Huawei eNSP. Экспериментальная топология показана на рисунке 3. Прямое соединение
выходного маршрутизатора представляет собой канал спутниковой связи, «маршрутизатор-Интернет»
представляет собой Интернет, а спутниковый канал предпочтительнее наземного канала. Туннель
IPSec устанавливается с использованием ESP, туннельного режима, автоматического согласования
IKE (двусторонняя связь) или ручной настройки (односторонняя связь).

[[PIC3, Экспериментальная топология]]

[[PIC4, Одноадресные данные при двусторонней связи]]

Проверка соединения между ПК и ПК1 или ПК2 проходит нормально. Захват пакета показывает, что
исходящим каналом между штаб-квартирой и CR является беспроводной канал. После отключения
интерфейсов CR GE0/0/1 и GE0/0/2 проверка соединения остается нормальной. Захват пакетов
показывает, что выходной канал HQ-CR является наземным каналом. В этом случае на Рис.4-а и
Рис.4-б показаны скриншоты данных захвата пакетов ПК1 и ПК2. Пакеты представляют собой обычный
текст, а IP-адреса заголовка пакета являются адресами терминалов. На рис.4-c и рис.4-d показаны
пакетные данные захвата интерфейса маршрутизатор-Интернет GE0/0/1 и GE0/0/2. Пакеты представляют
собой зашифрованный текст, а IP-адрес заголовка пакета является адресом интерфейса туннеля.

ПК1 и ПК2 подают заявку на обслуживание группы многоадресной рассылки 232.11.11.11 с ПК. На
рис.5-а и рис.5-б показано, что ПК1 и ПК2 могут принимать многоадресные пакеты. На рисунках 5-c
и 5-d показано, что многоадресные пакеты передаются в одноадресном зашифрованном тексте по
общедоступной сети.

[[PIC5, Многоадресная передача данных в случае двусторонней связи]]

В маршрутизаторе-Интернете статический маршрут к CR удаляется, а интерфейс CR GE0/0/1
закрывается для имитации однонаправленной связи от штаб-квартиры к судну 1. На рисунке 6
показана ситуация одноадресной рассылки во время однонаправленной связи. ПК проверяет связь с
ПК1, а пакеты запросов и ответов ICMP перехватываются с интерфейса AR1 GE0/0/2. Но из интерфейса
AR1 GE0/0/1 зашифрованные пакеты, отправленные с ПК на ПК1, могут быть только получены. На
рисунке 7 показана ситуация многоадресной рассылки при однонаправленной связи. ПК1 может получать
многоадресный пакет, который зашифрован в общедоступной сети.

В общем, как одноадресные, так и многоадресные данные, передаваемые в Интернете, могут быть
зашифрованы для передачи независимо от однонаправленной или двусторонней связи.

[[PIC6, Одноадресные данные в случае однонаправленной связи]]

[[PIC7, Многоадресная передача данных в случае однонаправленной связи]]

V. Заключение
GRE и IPSec являются технологиями туннелирования «точка-точка». В этом документе новаторски
предлагается применить технологию туннелирования GREoverIPSec к сети P2MP на основе
многоканального совместного использования между сторонами связи, чтобы обеспечить безопасную
связь «один ко многим» без снижения надежности каналов связи. сценарий применения транспортной
компании, разрабатывает схему развертывания двухканального общего туннеля GREoverIPSec и проводит
экспериментальную проверку в двухпроходных и однопроходных ситуациях соответственно, что может
обеспечить безопасность передачи информации в открытой коммуникационной среде.
